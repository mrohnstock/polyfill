// HTML5 Month polyfill | Jonathan Stipe | https://github.com/jonstipe/month-polyfill

(function(){(function($){$.fn.inputMonth=function(){var advanceMonth,compareMonths,decrement,increment,makeMonthDisplayString,makeMonthString,readMonth,regressMonth,stepNormalize;readMonth=function(m_str){var matchData,monthPart,yearPart;if(/^\d{4,}-\d\d$/.test(m_str)){matchData=/^(\d+)-(\d+)$/.exec(m_str);yearPart=parseInt(matchData[1],10);monthPart=parseInt(matchData[2],10);return{year:yearPart,month:monthPart};}else{throw"Invalid month string: "+m_str;}};makeMonthString=function(month_obj){var m_arr;m_arr=[month_obj['year'].toString()];m_arr.push('-');if(month_obj['month']<10){m_arr.push('0');}
m_arr.push(month_obj['month'].toString());return m_arr.join('');};makeMonthDisplayString=function(month_obj,elem){var $elem,month_arr,month_names;$elem=$(elem);month_names=$elem.datepicker("option","monthNames");month_arr=[month_names[month_obj['month']-1]];month_arr.push(' ');month_arr.push(month_obj['year'].toString());return month_arr.join('');};compareMonths=function(month1,month2){if(month1['year']>month2['year']){return-1;}else if(month1['year']===month2['year']){if(month1['month']>month2['month']){return-1;}else if(month1['month']===month2['month']){return 0;}else{return 1;}}else{return 1;}};advanceMonth=function(inMonth,amt){var outMonth;outMonth={year:inMonth['year'],month:inMonth['month']};outMonth['month']+=amt;if(outMonth['month']>12){outMonth['year']+=Math.floor(outMonth['month']/12);outMonth['month']=outMonth['month']%12;}
return outMonth;};regressMonth=function(inMonth,amt){var outMonth;outMonth={year:inMonth['year'],month:inMonth['month']};outMonth['month']-=amt;if(outMonth['month']<1){while(outMonth['month']<1){outMonth['year']-=1;outMonth['month']+=12;}}
return outMonth;};increment=function(hiddenField,monthBtn,calendarDiv){var $hiddenField,max,step,value;$hiddenField=$(hiddenField);value=readMonth($hiddenField.val());step=$hiddenField.data("step");max=$hiddenField.data("max");if(!(step!=null)||step==='any'){value=advanceMonth(value,1);}else{value=advanceMonth(value,step);}
if((max!=null)&&compareMonths(value,max)===-1){value['year']=max['year'];value['month']=max['month'];}
value=stepNormalize(value,hiddenField);$hiddenField.val(makeMonthString(value)).change();$(monthBtn).text(makeMonthDisplayString(value,calendarDiv));$(calendarDiv).datepicker("setDate",new Date(value['year'],value['month']-1));return null;};decrement=function(hiddenField,monthBtn,calendarDiv){var $hiddenField,min,step,value;$hiddenField=$(hiddenField);value=readMonth($hiddenField.val());step=$hiddenField.data("step");min=$hiddenField.data("min");if(!(step!=null)||step==='any'){value=regressMonth(value,1);}else{value=regressMonth(value,step);}
if((min!=null)&&compareMonths(value,min)===1){value['year']=min['year'];value['month']=min['month'];}
value=stepNormalize(value,hiddenField);$hiddenField.val(makeMonthString(value)).change();$(monthBtn).text(makeMonthDisplayString(value,calendarDiv));$(calendarDiv).datepicker("setDate",new Date(value['year'],value['month']-1));return null;};stepNormalize=function(inMonth,hiddenField){var $hiddenField,kNum,max,min,minNum,step,stepDiff,stepDiff2;$hiddenField=$(hiddenField);step=$hiddenField.data("step");min=$hiddenField.data("min");max=$hiddenField.data("max");if((step!=null)&&step!=='any'){kNum=(inMonth['year']*12)+inMonth['month'];if(min==null){min={year:1970,month:1};}
minNum=(min['year']*12)+min['month'];stepDiff=(kNum-minNum)%step;stepDiff2=step-stepDiff;if(stepDiff===0){return inMonth;}else{if(stepDiff>stepDiff2){return advanceMonth({year:inMonth['year'],month:inMonth['month']},stepDiff2);}else{return regressMonth({year:inMonth['year'],month:inMonth['month']},stepDiff);}}}else{return inMonth;}};$(this).filter('input[type="month"]').each(function(){var $calendarContainer,$calendarDiv,$hiddenField,$monthBtn,$this,calendarContainer,calendarDiv,className,closeFunc,hiddenField,max,min,monthBtn,step,style,value;$this=$(this);value=$this.attr('value');min=$this.attr('min');max=$this.attr('max');step=$this.attr('step');className=$this.attr('class');style=$this.attr('style');if((value!=null)&&/^\d{4,}-\d\d$/.test(value)){value=readMonth(value);}else{value=new Date();value={year:value.getFullYear(),month:value.getMonth()+1};}
if(min!=null){min=readMonth(min);if(compareMonths(value,min)===1){value['year']=min['year'];value['month']=min['month'];}}
if(max!=null){max=readMonth(max);if(compareMonths(value,max)===-1){value['year']=max['year'];value['month']=max['month'];}}
if((step!=null)&&step!=='any'){step=parseInt(step,10);}else{step=1;}
hiddenField=document.createElement('input');$hiddenField=$(hiddenField);$hiddenField.attr({type:"hidden",name:$this.attr('name'),value:makeMonthString(value)});$hiddenField.data({min:min,max:max,step:step});value=stepNormalize(value,hiddenField);$hiddenField.attr('value',makeMonthString(value));calendarContainer=document.createElement('span');$calendarContainer=$(calendarContainer);if(className!=null){$calendarContainer.attr('class',className);}
if(style!=null){$calendarContainer.attr('style',style);}
calendarDiv=document.createElement('div');$calendarDiv=$(calendarDiv);$calendarDiv.css({display:'none',position:'absolute'});monthBtn=document.createElement('button');$monthBtn=$(monthBtn);$monthBtn.addClass('month-datepicker-button');$this.replaceWith(hiddenField);$calendarContainer.insertAfter(hiddenField);$monthBtn.appendTo(calendarContainer);$calendarDiv.appendTo(calendarContainer);$calendarDiv.datepicker({dateFormat:'MM dd, yy',showButtonPanel:true,stepMonths:step});$monthBtn.text(makeMonthDisplayString(value,calendarDiv));if(min!=null){$calendarDiv.datepicker("option","minDate",new Date(min['year'],min['month']-1,1));}
if(max!=null){$calendarDiv.datepicker("option","maxDate",new Date(max['year'],max['month'],0));}
if(Modernizr.csstransitions){calendarDiv.className="month-calendar-dialog month-closed";$monthBtn.click(function(event){$calendarDiv.off('transitionend oTransitionEnd webkitTransitionEnd MSTransitionEnd');calendarDiv.style.display='block';calendarDiv.className="month-calendar-dialog month-open";event.preventDefault();return false;});closeFunc=function(event){var transitionend_function;if(calendarDiv.className==="month-calendar-dialog month-open"){transitionend_function=function(event,ui){calendarDiv.style.display='none';$calendarDiv.off("transitionend oTransitionEnd webkitTransitionEnd MSTransitionEnd",transitionend_function);return null;};$calendarDiv.on("transitionend oTransitionEnd webkitTransitionEnd MSTransitionEnd",transitionend_function);calendarDiv.className="month-calendar-dialog month-closed";}
if(event!=null){event.preventDefault();}
return null;};}else{$monthBtn.click(function(event){$calendarDiv.fadeIn('fast');event.preventDefault();return false;});closeFunc=function(event){$calendarDiv.fadeOut('fast');if(event!=null){event.preventDefault();}
return null;};}
$calendarDiv.mouseleave(closeFunc);$calendarDiv.datepicker("option","onSelect",function(dateText,inst){var dateObj,monthObj;dateObj=$.datepicker.parseDate('MM dd, yy',dateText);monthObj={year:dateObj.getFullYear(),month:dateObj.getMonth()+1};$hiddenField.val(makeMonthString(monthObj)).change();$monthBtn.text(makeMonthDisplayString(monthObj,calendarDiv));closeFunc();return null;});$calendarDiv.datepicker("setDate",new Date(value['year'],value['month']-1,1));$monthBtn.on({DOMMouseScroll:function(event){if(event.originalEvent.detail<0){increment(hiddenField,monthBtn,calendarDiv);}else{decrement(hiddenField,monthBtn,calendarDiv);}
event.preventDefault();return null;},mousewheel:function(event){if(event.originalEvent.wheelDelta>0){increment(hiddenField,monthBtn,calendarDiv);}else{decrement(hiddenField,monthBtn,calendarDiv);}
event.preventDefault();return null;},keypress:function(event){if(event.keyCode===38){increment(hiddenField,monthBtn,calendarDiv);event.preventDefault();}else if(event.keyCode===40){decrement(hiddenField,monthBtn,calendarDiv);event.preventDefault();}
return null;}});return null;});return this;};$(function(){if(!Modernizr.inputtypes.month){$('input[type="month"]').inputMonth();}
return null;});return null;})(jQuery);}).call(this);