// HTML5 Color polyfill | Jonathan Stipe | https://github.com/jonstipe/color-polyfill

$(function(){if(!Modernizr.inputtypes.color){var e=function(e,t,n){var r=e.toString(16),i=t.toString(16),s=n.toString(16);while(r.length<2){r="0"+r}while(i.length<2){i="0"+i}while(s.length<2){s="0"+s}return"#"+r+i+s};var t=function(e,t,n){e=e/255,t=t/255,n=n/255;var r=Math.max(e,t,n),i=Math.min(e,t,n);var s,o,u=r;var a=r-i;o=r==0?0:a/r;if(r==i){s=0}else{switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4;break}s/=6}return[Math.round(s*360),Math.round(o*100*10)/10,Math.round(u*100*10)/10]};var n=function(e,t,n){e=e/360,t=t/100,n=n/100;var r,i,s;var o=Math.floor(e*6);var u=e*6-o;var a=n*(1-t);var f=n*(1-u*t);var l=n*(1-(1-u)*t);switch(o%6){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;case 5:r=n,i=a,s=f;break}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]};var r=function(e){if(/^\d+$/.test(this.value)){if(parseInt(this.value,10)>e){$(this).val(e)}else if(parseInt(this.value,10)<0){$(this).val(0)}}else if(/^[a-fA-F\d]{2}$/.test(this.value)){$(this).val(parseInt(this.value,16))}else{$(this).val(0)}};$('input[type="color"]').each(function(i){var s=$(this).attr("value")||"#000000";var o=parseInt(s.substring(1,3),16);var u=parseInt(s.substring(3,5),16);var a=parseInt(s.substring(5,7),16);var f=t(o,u,a);var l=document.createElement("input");$(l).attr({type:"hidden",name:$(this).attr("name"),value:s});var c=document.createElement("span");$(c).addClass("color-picker-button-container");var h=document.createElement("button");var p=document.createElement("div");h.appendChild(p);$(h).addClass("color-picker-button");p.style.backgroundColor=s;$(this).replaceWith(l);c.appendChild(h);$(c).insertAfter(l);var d=document.createElement("div");$(d).addClass("color-picker-dialog");d.style.display="none";var v=document.createElement("div");$(v).addClass("color-swatch-container");var m=document.createElement("div");$(m).addClass("color-swatch");m.style.backgroundColor=s;var g=document.createElement("ul");var y=document.createElement("li");$(y).addClass("hue-slider-li");var b=document.createElement("div");$(b).addClass("hue-color-slider");var w=document.createElement("input");$(w).attr({type:"text",size:"3",value:f[0]});y.appendChild(b);y.appendChild(w);g.appendChild(y);var E=document.createElement("li");$(E).addClass("sat-slider-li");var S=document.createElement("div");$(S).addClass("sat-color-slider");var x=document.createElement("input");$(x).attr({type:"text",size:"3",value:f[1]});E.appendChild(S);E.appendChild(x);g.appendChild(E);var T=document.createElement("li");$(T).addClass("val-slider-li");var N=document.createElement("div");$(N).addClass("val-color-slider");var C=document.createElement("input");$(C).attr({type:"text",size:"3",value:f[2]});T.appendChild(N);T.appendChild(C);g.appendChild(T);var k=document.createElement("li");$(k).addClass("red-slider-li");var L=document.createElement("div");$(L).addClass("red-color-slider");var A=document.createElement("input");$(A).attr({type:"text",size:"3",value:o});k.appendChild(L);k.appendChild(A);g.appendChild(k);var O=document.createElement("li");$(O).addClass("green-slider-li");var M=document.createElement("div");$(M).addClass("green-color-slider");var _=document.createElement("input");$(_).attr({type:"text",size:"3",value:u});O.appendChild(M);O.appendChild(_);g.appendChild(O);var D=document.createElement("li");$(D).addClass("blue-slider-li");var P=document.createElement("div");$(P).addClass("blue-color-slider");var H=document.createElement("input");$(H).attr({type:"text",size:"3",value:a});D.appendChild(P);D.appendChild(H);g.appendChild(D);var B=document.createElement("input");$(B).attr({type:"text",size:"7",value:s});var j=document.createElement("button");$(j).text("OK");$(j).addClass("color-picker-ok-button");d.appendChild(v);v.appendChild(m);v.appendChild(B);d.appendChild(g);d.appendChild(j);c.appendChild(d);$(b).slider({orientation:"horizontal",min:0,max:360,range:"min",value:$(w).val()});$(S).slider({orientation:"horizontal",min:0,max:100,step:.1,range:"min",value:$(x).val()});$(N).slider({orientation:"horizontal",min:0,max:100,step:.1,range:"min",value:$(C).val()});$(L).slider({orientation:"horizontal",min:0,max:255,range:"min",value:$(A).val()});$(M).slider({orientation:"horizontal",min:0,max:255,range:"min",value:$(_).val()});$(P).slider({orientation:"horizontal",min:0,max:255,range:"min",value:$(H).val()});var F=function(){var t=n(parseInt($(w).val(),10),parseFloat($(x).val()),parseFloat($(C).val()));var r=e(t[0],t[1],t[2]);$(L).slider("option","value",t[0]);$(M).slider("option","value",t[1]);$(P).slider("option","value",t[2]);$(A).val(t[0]);$(_).val(t[1]);$(H).val(t[2]);$(B).val(r);m.style.backgroundColor=r;p.style.backgroundColor=r;$(l).val(r.toLowerCase())};var I=function(){var n=t(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10));var r=e(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10));$(b).slider("option","value",n[0]);$(S).slider("option","value",n[1]);$(N).slider("option","value",n[2]);$(w).val(n[0]);$(x).val(n[1]);$(C).val(n[2]);$(B).val(r);m.style.backgroundColor=r;p.style.backgroundColor=r;$(l).val(r.toLowerCase())};var q=function(){var t=n(parseInt($(w).val(),10),parseInt($(x).val(),10),parseInt($(C).val(),10));var r=e(t[0],t[1],t[2]);$(L).slider("option","value",t[0]);$(M).slider("option","value",t[1]);$(P).slider("option","value",t[2]);$(A).val(t[0]);$(_).val(t[1]);$(H).val(t[2]);m.style.backgroundColor=r;$(B).val(r)};var R=function(){var t=n(parseInt($(w).val(),10),parseInt($(x).val(),10),parseInt($(C).val(),10));var r=e(t[0],t[1],t[2]);$(L).slider("option","value",t[0]);$(M).slider("option","value",t[1]);$(P).slider("option","value",t[2]);$(A).val(t[0]);$(_).val(t[1]);$(H).val(t[2]);m.style.backgroundColor=r;$(B).val(r);p.style.backgroundColor=r;$(l).val(r.toLowerCase())};var U=function(){var n=t(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10));var r=e(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10));$(b).slider("option","value",n[0]);$(S).slider("option","value",n[1]);$(N).slider("option","value",n[2]);$(w).val(n[0]);$(x).val(n[1]);$(C).val(n[2]);$(B).val(r);m.style.backgroundColor=r};var z=function(){var n=t(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10));var r=e(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10));$(b).slider("option","value",n[0]);$(S).slider("option","value",n[1]);$(N).slider("option","value",n[2]);$(B).val(r);$(w).val(n[0]);$(x).val(n[1]);$(C).val(n[2]);m.style.backgroundColor=r;p.style.backgroundColor=r;$(l).val(r.toLowerCase())};$(B).change(function(){if(/^[a-fA-F\d]{6}$/.test(this.value)){$(this).val("#"+this.value)}if(/^#[a-fA-F\d]{6}$/.test(this.value)){var n=parseInt(this.value.substring(1,3),16);var r=parseInt(this.value.substring(3,5),16);var i=parseInt(this.value.substring(5,7),16);var s=t(n,r,i);m.style.backgroundColor=this.value;$(w).val(s[0]);$(x).val(s[1]);$(C).val(s[2]);$(A).val(n);$(_).val(r);$(H).val(i);$(b).slider("option","value",s[0]);$(S).slider("option","value",s[1]);$(N).slider("option","value",s[2]);$(L).slider("option","value",n);$(M).slider("option","value",r);$(P).slider("option","value",i);p.style.backgroundColor=this.value;$(l).val(this.value.toLowerCase())}else{$(this).val(e(parseInt($(A).val(),10),parseInt($(_).val(),10),parseInt($(H).val(),10)))}});$(w).change(function(){r.call(this,360);$(b).slider("option","value",parseInt(this.value,10));F()});$(x).change(function(){r.call(this,100);$(S).slider("option","value",parseInt(this.value,10));F()});$(C).change(function(){r.call(this,100);$(N).slider("option","value",parseInt(this.value,10));F()});$(A).change(function(){r.call(this,255);$(L).slider("option","value",parseInt(this.value,10));I()});$(_).change(function(){r.call(this,255);$(M).slider("option","value",parseInt(this.value,10));I()});$(H).change(function(){r.call(this,255);$(P).slider("option","value",parseInt(this.value,10));I()});$(b).bind({slide:function(e,t){if(e.originalEvent!==undefined){$(w).val($(this).slider("value"));q()}},slidechange:function(e,t){if(e.originalEvent!==undefined){$(w).val($(this).slider("value"));R()}}});$(S).bind({slide:function(e,t){if(e.originalEvent!==undefined){$(x).val($(this).slider("value"));q()}},slidechange:function(e,t){if(e.originalEvent!==undefined){$(x).val($(this).slider("value"));R()}}});$(N).bind({slide:function(e,t){if(e.originalEvent!==undefined){$(C).val($(this).slider("value"));q()}},slidechange:function(e,t){if(e.originalEvent!==undefined){$(C).val($(this).slider("value"));R()}}});$(L).bind({slide:function(e,t){if(e.originalEvent!==undefined){$(A).val($(this).slider("value"));U()}},slidechange:function(e,t){if(e.originalEvent!==undefined){$(A).val($(this).slider("value"));z()}}});$(M).bind({slide:function(e,t){if(e.originalEvent!==undefined){$(_).val($(this).slider("value"));U()}},slidechange:function(e,t){if(e.originalEvent!==undefined){$(_).val($(this).slider("value"));z()}}});$(P).bind({slide:function(e,t){if(e.originalEvent!==undefined){$(H).val($(this).slider("value"));U()}},slidechange:function(e,t){if(e.originalEvent!==undefined){$(H).val($(this).slider("value"));z()}}});if(Modernizr.csstransitions){d.className="color-picker-dialog color-picker-closed";$(h).click(function(){$(d).unbind("transitionend");$(d).unbind("oTransitionEnd");$(d).unbind("webkitTransitionEnd");$(d).unbind("MSTransitionEnd");d.style.display="block";$(d).css("opacity");d.className="color-picker-dialog color-picker-open";return false});var W=function(){if(d.className=="color-picker-dialog color-picker-open"){var e=function(t,n){d.style.display="none";$(d).unbind({transitionend:e,oTransitionEnd:e,webkitTransitionEnd:e,MSTransitionEnd:e})};$(d).bind({transitionend:e,oTransitionEnd:e,webkitTransitionEnd:e,MSTransitionEnd:e});d.className="color-picker-dialog color-picker-closed";return false}};$(d).mouseleave(W);$(j).click(W)}else{$(h).click(function(){$(d).fadeIn();return false});var W=function(){$(d).fadeOut();return false};$(d).mouseleave(W);$(j).click(W)}})}})